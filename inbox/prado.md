# Прадо Машинное обучение: алгоритмы для бизнеса

- [сайт автора](https://www.quantresearch.org/index.html)

В этой книге в общих чертах излагается план фабрики, где работа в команде порождает открытия с предсказуемой скоростью, не полагаясь на неожиданную удачу.

Открытие инвестиционных стратегий претерпело эволюцию. Если десять лет назад была относительно распространенной ситуация, когда отдельный специалист находил макроскопический альфа (то есть используя простые математические инструменты, такие как эконометрия), в настоящее время шансы на это быстро сходятся к нулю. Специалисты, которые в наши дни ищут макроскопический альфа, вне зависимости от своей квалификации или опыта сталкиваются с колоссальными трудностями. Единственный истинный альфа сегодня микроскопичен, а его отыскание требует капиталоемких промышленных методов. Как и в случае с золотом, микроскопический альфа не означает пониженную суммарную прибыль.  Микроскопический альфа сегодня богаче, чем макроскопический альфа когда-либо был в истории.  И на нем можно заработать немало денег, но для этого вам потребуется тяжелая артиллерия МО.

## Участки производственной цепочки

### Кураторы данных
Этот участок отвечает за сбор, очистку, индексирование, хранение, корректировку и доставку всех данных в производственную цепочку.
Значения могут быть табличными или иерархическими, выровненными или несогласованными, историческими или в режиме реального времени и т.д. 
Члены команды являются экспертами в области микроструктуры рынка и протоколов передачи данных

### Признаковые аналитики
Этот участок отвечает за трансформирование необработанных данных в информативные сигналы. 
Эти информативные сигналы обладают некоторой предсказательной силой над финансовыми величинами. 
Члены команды являются экспертами в области теории информации, извлечения и обработки сигналов, визуализации, маркировки, взвешивания, классификаторов и методов определения важности признаков.
Распространенной ошибкой считается то, что признаковые аналитики занимаются разработкой стратегий. 
Напротив, признаковые аналитики занимаются сбором и каталогизацией библиотек находок, которые могут быть полезны для многочисленных участков.

### Стратеги
На этом участке информативные признаки трансформируются в реальные инвестиционные алгоритмы. 
Стратег будет разбирать библиотеки признаков в поисках идей для разработки инвестиционной стратегии. 
Эти признаки были обнаружены разными аналитиками, изучающими широкий спектр финансовых инструментов и классов активов. 
Цель стратега — осмыслить все эти наблюдения и сформулировать общую теорию, их объясняющую. 
Поэтому стратегия — это всего лишь эксперимент, призванный проверить обоснованность этой теории. 
Членами команды являются аналитики данных с глубокими знаниями финансовых рынков и экономики. 
Напомним, что теория должна объяснять большую совокупность важных признаков. 
В частности, теория должна определить экономический механизм, который заставляет агента терять деньги для нас. Что это? Поведенческое смещение? Асимметричная информация? Нормативные ограничения? 
Признаки могут быть обнаружены «черным ящиком», но стратегия разрабатывается в «белом ящике».


### Бэктестеры
Этот участок оценивает прибыльность инвестиционной стратегии в рамках разных сценариев. 
Одним из интересных сценариев является то, как стратегия будет работать, если история повторится. 
Тем не менее историческая траектория является лишь одним из возможных исходов стохастического процесса, и не обязательно наиболее вероятна в будущем. 
Необходимо провести оценку альтернативных сценариев в соответствии с имеющимися знаниями о слабых и сильных сторонах предлагаемой стратегии. 
Членами команды являются аналитики данных с глубоким пониманием эмпирических и экспериментальных методов. 
Грамотный бэктестировщик встраивает в свой анализ метаинформацию о том, как стратегия появилась. 
В частности, его анализ должен оценивать вероятность переподгонки бэктеста, принимая в расчет число испытаний, потребовавшихся для отшлифовки стратегии.

### Команда развертывания
Команда развертывания занимается интегрированием кода стратегии в производственную линию. 
Некоторые компоненты могут использоваться сразу в нескольких стратегиях, особенно если они обладают общими признаками. 
Членами команды являются специалисты по алгоритмам и профессиональные математические программисты. 
Частью их работы является обеспечение того, чтобы развернутое решение было логически идентично полученному прототипу.

### Портфельный мониторинг

Перед развертыванием каждая стратегия проходит cursus honorum, который подразумевает следующие этапы, или следующий цикл:

1. Эмбарго: изначально стратегия запускается на основе данных, полученных после конечной даты бэктеста. 
Данный этап вводится специалистами по бэктестингу или возникает в результате задержек внедрения. 
Если поведение стратегии в период эмбарго соответствует результатам бэктеста, стратегия переходит на следующий этап.

2. Бумажный трейдинг: в этой точке стратегия выполняется на живых реальных данных. Благодаря этому в результативности будут учитываться задержки, связанные с разбором данных, расчетами, исполнением, и другие промежутки времени между наблюдением и занятием позиции. Бумажный трейдинг будет происходить столько, сколько необходимо для сбора достаточных доказательств того, что стратегия работает так, как ожидалось.

3. Выпуск: в этой точке стратегия управляет реальной позицией, будь то в изоляции или в составе ансамбля. Результативность оценивается точно, включая приписываемые риски, финансовые возвраты и издержки.

4. Переразмещение: исходя из производственной результативности, размещение финансовых активов в выпускные стратегии часто и автоматически пересматривается в контексте диверсифицированного портфеля. В общем случае размещение в стратегии следует вогнутой функции. Начальное размещение (при выпуске) небольшое. По прошествии времени и по мере того, как стратегия показывает ожидаемую результативность, это размещение увеличивается. По прошествии времени результативность снижается, и размещение постепенно уменьшается.

5. Комиссование: в конечном итоге все стратегии выводятся из эксплуатации. Это происходит, когда они показывают результативность ниже ожидаемой на протяжении достаточно продолжительного периода времени, чтобы заключить, что поддерживающая теория больше не подкрепляется эмпирическими данными.

## Структура по компонентам стратегии

### Данные
- Проблема: «мусор на входе — мусор на выходе»
- Решение: работайте с уникальными данными, которые сложно подтасовать. Если вы единственный, кто использует эти данные, то выжимайте из них максимум.

### Программное обеспечение
- Проблема: специализированная задача требует наличия специальных инструментов.
- Решение: разработать собственные классы. Использование популярных библиотек означает больше конкурентов, которые используют тот же источник.

### Аппаратное обеспечение
- Проблема: машинное обучение связано с несколькими самыми сложными вычислительными задачами в математике.
- Решение: стать экспертом в области высокопроизводительных вычислений. 

### Математика
Проблема: процесс математического доказательства может занимать годы, десятилетия и столетия. Ни один инвестор не будет ждать так долго.
Решение: использовать экспериментальную математику. Решать сложные, трудноразрешимые задачи не путем доказательства, а путем эксперимента.

### Метастратегии
- Проблема: любители разрабатывают индивидуальные стратегии, веря, что существует волшебная формула обогащения. В отличие от них, профессионалы разрабатывают методы для массового производства стратегий. Деньги зарабатываются не сборкой одного автомобиля, а построением автомобильного завода.
- Решение: мыслить как предприятие. Ваша цель — управлять исследовательской лабораторией как фабрикой, где истинные открытия рождаются не из вдохновения. В этом заключалась философия Эрнеста Лоуренса, основателя первой Национальной лаборатории США.

### Переподгонка, или переобучение
Проблема: стандартные перекрестно-проверочные методы в финансовом деле не справляются. Большинство открытий в области финансов оказываются ложными вследствие множественного тестирования и систематического смещения при отборе.
Решение: что бы вы ни делали, всегда задавайте себе вопрос — в чем вы можете переобучить модель? Относитесь скептически к своим результатам и постоянно ставьте перед собой новые задачи.


## Бэктест

### Семь смертных грехов квантильного инвестирования

- [источник](https://www.columbia.edu/~nyc2107/papers/seven_sins_of_quantitative_investing.pdf)
- [pdf](/res/seven_sins_of_quantitative_investing.pdf)

1. Систематическое смещение по выживаемости (survivorship bias): использование в качестве инвестиционного универсума текущего универсума и, следовательно, игнорирование того, что некоторые компании обанкротились, а ценные бумаги были исключены из списка.
2. Систематическое смещение из-за забегания вперед (look-ahead bias): использование информации, которая не была публичной в момент принятия симулируемого решения. Полная уверенность во временном штампе для каждой точки данных. Принятие в расчет дат публикации данных, задержек в их распространении и исправлений задним числом.
3. Сторителлинг: выдумывание истории постфактум, для того чтобы оправдать случайную закономерность.
4. Извлечение данных и прочесывание данных: тренировка модели на тестовом подмножестве.
5. Транзакционные издержки: просимулировать транзакционные издержки (стоимости) тяжело, потому что единственный способ быть уверенным в этой издержке состоял бы в том, чтобы взаимодействовать с торговой книгой (то есть выполнять фактическую торговлю).
6. Выбросы: базирование стратегии на нескольких экстремальных исходах, которые вполне могут никогда не повториться снова точно так же, как они наблюдались в прошлом.
7. Шортирование: для занятия короткой позиции на фактических (денежных) продуктах необходимо найти кредитора. Стоимость кредитования и доступная сумма, как правило, неизвестны и зависят от связей, оборотного капитала, относительного спроса и т. д.


Предназначение бэктестирования — отбрасывать плохие модели, а не улучшить их. Корректировка вашей модели на основе результатов бэктестирования — это пустая трата времени... и она опасна. 
Инвестируйте свое время и усилия в то, чтобы все компоненты были правильными: структурированные данные, маркировка, взвешивание, ансамбли, перекрестная проверка, важность признаков, размер ставок и т. д. 
Ко времени бэктестирования уже будет поздно. 
Никогда не бэктестируйте, пока модель не будет полностью определена. 
Если бэктестирование окажется безуспешным, начните все сначала. 
Если вы поступите именно так, то шансы найти ложное открытие существенно снизятся, но все равно они не будут равны нулю.

Хотя нет простого способа предотвратить переподгонку, ряд шагов способны помочь уменьшить ее присутствие.

1. Разрабатывать модели для целых классов активов или инвестиционных универсумов, а не для конкретных ценных бумаг. Инвесторы диверсифицируют, следовательно, они не делают ошибки X только на ценной бумаге Y. Если вы найдете ошибку X только на ценной бумаге Y, независимо от того, насколько на первый взгляд она прибыльна, скорее всего это ложное открытие.
2. Применять бэггирование как средство предотвращения переподгонки и уменьшения дисперсии предсказательной ошибки. Если бэггирование ухудшает результативность стратегии, то вполне вероятно, оно переподогнано к небольшому числу наблюдений или выбросам.
3. Не проводить бэктестирование до тех пор, пока все исследования не будут завершены.
4. Записывать каждый бэктест, проводимый на совокупности данных, так чтобы вероятность бэктестовой переподгонки могла быть оценена на окончательном отобранном результате и коэффициент Шарпа мог быть правильно дефлирован числом проведенных испытаний.
5. Симулировать сценарии, а не историю. Стандартный бэктест — это историческое симулирование, которое можно легко перенастроить. История — это просто одна из случайных траекторий, которая была реализована, и она могла быть совершенно другой. Ваша стратегия должна быть прибыльной при широком спектре сценариев, а не только на эпизодической исторической траектории. Труднее достичь переподгонки исхода тысячи сценариев, отвечающих на вопрос «а что если?».
6. Если бэктест оказался безуспешным в выявлении прибыльной стратегии, то начать с нуля. Не поддавайтесь искушению многократно использовать эти результаты. Следуйте второму закону тестирования на исторических данных.

«Проведение бэктестирования во время исследования равносильно выпивке за рулем. Не следует проводить исследования под воздействием бэктеста».
— Маркос Лопез де Прадо Машинное обучение: алгоритмы для бизнеса (2018)

## Структурные сдвиги

При разработке инвестиционной стратегии на основе машинного обучения мы, как правило, хотим делать ставки, когда происходит слияние факторов, предсказанный исход которых обеспечивает благоприятный скорректированный на риск финансовый возврат. Структурные сдвиги, как и переход от одного рыночного режима к другому, являются одним из примеров такого слияния, и он представляет особый интерес. Например, закономерность возвращения к среднему значению может смениться импульсной закономерностью. Когда этот переход происходит, большинство участников рынка оказываются застигнутыми врасплох и будут делать дорогостоящие ошибки. Такого рода ошибки являются основой для многих прибыльных стратегий, потому что игроки на проигравшей стороне, как правило, осознают свою ошибку, когда уже слишком поздно.


## Энтропийные признаки

Ценовой ряд передает информацию о силах спроса и предложения. На идеальных рынках цены непредсказуемы, потому что каждое наблюдение транслирует все, что известно о продукте или услуге. При несовершенстве рынков цены формируются с частичной информацией, и поскольку некоторые агенты знают больше других, то могут эксплуатировать эту информационную асимметрию. Было бы полезно оценивать информационное содержимое ценового ряда и формировать признаки, на которых алгоритмы МО способны заучивать вероятные исходы. Например, алгоритм МО может обнаружить, что импульсные ставки выгоднее, когда цены несут мало информации, и что ставки на возврате к среднему значению выгоднее, когда цены несут много информации.


## Микроструктурные признаки

Рыночная микроструктура изучает «процесс и результаты обмена активами по четким правилам биржевой торговли». Микроструктурные совокупности данных включают первичную информацию о процессе аукциона, такую как отмены заказов, книга двойного аукциона, очереди, частичные исполнения, сторона агрессора1, исправления, замены и т.д. Основным источником являются сообщения по протоколу FIX (Financial Information eXchange, биржа финансовой информации), которые можно приобрести на биржах. Уровень детализации, содержащийся в сообщениях FIX, дает исследователям возможность понять, как участники рынка скрывают и раскрывают свои намерения. Это делает микроструктурные данные одним из наиболее важных компонентов для построения предсказательных признаков, используемых в машинном обучении.

### Microstructure

https://singlelogin.re/book/3562844/1f1d90/trades-quotes-and-prices-financial-markets-under-the-microscope.html?dsource=recommend
https://singlelogin.re/book/655281/4440a1/microscopic-simulation-of-financial-markets-from-investor-behavior-to-market-phenomena.html?dsource=recommend
https://singlelogin.re/book/2772745/7fd416/limit-order-books.html?dsource=recommend
https://singlelogin.re/book/18022924/2c6ed5/depth-of-market-trading-setups-the-latest-in-futures-trading-tools.html?dsource=recommend

## Выявление высокочастотных событий с помощью неравномерного быстрого преобразования Фурье



